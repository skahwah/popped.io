<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Playing with CVE-2013-3893 in Metasploit – popped.io</title> <meta name="description" content="A collection of my security research, random projects and attempts to amuse."> <meta name="keywords" content="ie_setmousecapture_uaf, Metasploit Framework, Office 2013, Internet Explorer, CVE-2013-3893, Windows 7"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/me.png"> <meta name="twitter:title" content="Playing with CVE-2013-3893 in Metasploit"> <meta name="twitter:description" content="Here’s a quick write up about using the new ie_setmousecapture_uaf exploit in Metasploit. This was done in a test environment within my Security lab."> <meta name="twitter:site" content="@hackerjiv"> <meta name="twitter:creator" content="@hackerjiv"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Playing with CVE-2013-3893 in Metasploit"> <meta property="og:description" content="Here’s a quick write up about using the new ie_setmousecapture_uaf exploit in Metasploit. This was done in a test environment within my Security lab."> <meta property="og:url" content="http://localhost:4000/playing-with-cve-2013-3893-in-metasploit_30/"> <meta property="og:site_name" content="popped.io"> <meta property="og:image" content="http://localhost:4000/assets/img/me.png"> <link rel="canonical" href="http://localhost:4000/playing-with-cve-2013-3893-in-metasploit_30/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="popped.io Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png"> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> <!-- Begin Jekyll SEO tag v2.2.3 --> <title>Playing with CVE-2013-3893 in Metasploit | popped.io</title> <meta property="og:title" content="Playing with CVE-2013-3893 in Metasploit"> <meta name="author" content="Sanjiv Kawa"> <meta property="og:locale" content="en_US"> <meta name="description" content="Here’s a quick write up about using the new ie_setmousecapture_uaf exploit in Metasploit. This was done in a test environment within my Security lab."> <meta property="og:description" content="Here’s a quick write up about using the new ie_setmousecapture_uaf exploit in Metasploit. This was done in a test environment within my Security lab."> <link rel="canonical" href="http://localhost:4000/playing-with-cve-2013-3893-in-metasploit_30/"> <meta property="og:url" content="http://localhost:4000/playing-with-cve-2013-3893-in-metasploit_30/"> <meta property="og:site_name" content="popped.io"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2013-10-01T01:00:00-04:00"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@Sanjiv Kawa"> <script type="application/ld+json"> {"@context":"http://schema.org","@type":"BlogPosting","headline":"Playing with CVE-2013-3893 in Metasploit","author":{"@type":"Person","name":"Sanjiv Kawa"},"datePublished":"2013-10-01T01:00:00-04:00","dateModified":"2013-10-01T01:00:00-04:00","description":"Here’s a quick write up about using the new ie_setmousecapture_uaf exploit in Metasploit. This was done in a test environment within my Security lab.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/me.png"},"name":"Sanjiv Kawa"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/playing-with-cve-2013-3893-in-metasploit_30/"},"url":"http://localhost:4000/playing-with-cve-2013-3893-in-metasploit_30/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/me.png" alt="popped.io photo" class="author-photo"> <h4>popped.io</h4> <p>A collection of my security research, random projects and attempts to amuse.</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:sanjiv@popped.io" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://twitter.com/hackerjiv" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://linkedin.com/in/sanjivkawa" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/skahwah" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> <li><a href="http://localhost:4000/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Playing with CVE-2013-3893 in Metasploit</h1> <h4>01 Oct 2013</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~2 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>Here’s a quick write up about using the new ie_setmousecapture_uaf exploit in Metasploit. This was done in a test environment within my Security lab.</p> <p>For the past two week’s I’ve been closely following the new Internet Explorer Zero Day which affects all versions of Internet Explorer. About a week ago the code was disclosed, after the disclosure I’m sure that everyone in the Security community knew that it was only a matter a time before the exploit was packaged into the Metasploit Framework; and about 6 hours ago, it was!</p> <p>A big thanks to Wei Chen for providing an excellent write up in the rapid7 community blog. As a side note, at this time, remote code execution currently only works through IE 9. As a supplementary Microsoft Office 2007 or 2010 also has to be installed.</p> <p>Some quick ifconfigs:</p> <figure class="half"> <img src="https://3.bp.blogspot.com/-4j5u4DLSWtg/UkpMfQUle4I/AAAAAAAABZc/elYbyrmj4VI/s1600/Screen+Shot+2013-09-30+at+10.14.03+PM.png"> <img src="https://2.bp.blogspot.com/-JEGmxn98uTc/UkpOScBBKYI/AAAAAAAABZo/VN34IzE3eJg/s1600/Screen+Shot+2013-09-30+at+10.22.33+PM.png"> </figure> <p>Lets fire up the ie_setmousecapture_uaf exploit in msf on my host machine (10.10.10.2)</p> <figure> <center> <img src="https://1.bp.blogspot.com/-9DhuJHx7xe4/UkpTqPcew6I/AAAAAAAABZ4/jS33djkKeLg/s1600/Screen+Shot+2013-09-30+at+10.41.14+PM.png"> </center> </figure> <p>Notice that we have started the remote listener on the port 4444. This will listen for a connection which will be established when the victim hits this link: <code class="highlighter-rouge">http://10.10.10.2:8080/Gss2DEpyAVBeqx</code></p> <p>The link can be sent to the victim through various means, my personal choice would be to convert the malicious link into a bitly or tinyURL first before sending it via email or social media message/post to the victim. This add’s a layer of obfuscation so that we can hide our real intent; For testing purposes I’m just going to send the plaintext IP to the victim machine.</p> <p>The victim opens up the link in Internet Explorer. The response is just a generic white page, however we can see that the URL has changed on the victims side. It appears that the Microsoft Office hxds.dll can be loaded in to IE in order for the remote code execution to be leveraged.</p> <figure> <center> <img src="https://4.bp.blogspot.com/-FvtJUBVfdSw/UkpT5l257sI/AAAAAAAABaE/9O5FSbvTAJg/s1600/Screen+Shot+2013-09-30+at+10.43.05+PM.png"> </center> </figure> <p>On our host/attackers machine we can see that we have successfully spawned notepad as a process to migrate the payload to, from there we can open up the meterpreter session and do what ever we want with out victims machine.</p> <figure> <center> <img src="https://3.bp.blogspot.com/-pz0T7Z_hXcE/UkpVK3ZnlSI/AAAAAAAABaQ/HIoIupypSEI/s1600/Screen+Shot+2013-09-30+at+10.44.33+PM.png"> </center> </figure> <p>Typically at this point the victim won’t suspect anything and close the browser. However our connection is still valid through the notepad.exe process due to the process migration. Lets take a quick look over on our victim’s machine. As we can see the process is still valid in memory until the user restarts their machine or potentially logs out.</p> <figure class="half"> <img src="https://4.bp.blogspot.com/-L7sCTi9-7KM/UkpVVEDqrII/AAAAAAAABaU/9cti6Oe8t4Y/s1600/Screen+Shot+2013-09-30+at+10.45.12+PM.png"> <img src="https://4.bp.blogspot.com/-44KurUcedn0/UkpVWkhpjaI/AAAAAAAABac/7RQ4SAwpeik/s1600/Screen+Shot+2013-09-30+at+10.45.48+PM.png"> </figure> <p>Thanks for reading guys.</p> <div class="entry-meta">  <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#ie_setmousecapture_uaf" title="Pages tagged ie_setmousecapture_uaf" class="tag"><span class="term">ie_setmousecapture_uaf</span></a><a href="http://localhost:4000/tags/#Metasploit%20Framework" title="Pages tagged Metasploit Framework" class="tag"><span class="term">Metasploit Framework</span></a><a href="http://localhost:4000/tags/#Office%202013" title="Pages tagged Office 2013" class="tag"><span class="term">Office 2013</span></a><a href="http://localhost:4000/tags/#Internet%20Explorer" title="Pages tagged Internet Explorer" class="tag"><span class="term">Internet Explorer</span></a><a href="http://localhost:4000/tags/#CVE-2013-3893" title="Pages tagged CVE-2013-3893" class="tag"><span class="term">CVE-2013-3893</span></a><a href="http://localhost:4000/tags/#Windows%207" title="Pages tagged Windows 7" class="tag"><span class="term">Windows 7</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/playing-with-cve-2013-3893-in-metasploit_30/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/playing-with-cve-2013-3893-in-metasploit_30/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/playing-with-cve-2013-3893-in-metasploit_30/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-85516324-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <script type="text/javascript"> var disqus_shortname = 'sanjivkawa'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>  </body>
</html>
